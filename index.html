<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
        integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="flexhtml.js"></script>
    <link rel="stylesheet" href="flexhtml.css">
    <!-- icon -->
    <link rel="icon" href="https://img.icons8.com/pulsar-color/48/share-3.png" type="image/x-icon">
    <title>Liff Share FLex</title>
    <style>
        body {
            background-color: #fafafa;
            /* background-color: #000; */
        }

        .hide {
            display: none;
        }

        #login-sec {
            min-height: 100vh;
        }

        .linebg {
            background-color: #00B900;
        }

        #flexlist {
            height: 200px;
            /* width: 200px; */
            /* background-color: #000; */
        }
    </style>
</head>

<body>

    <section id="login-sec" class="d-flex justify-content-center align-items-center">
        <div class="border rounded-3 shadow p-4 hide">
            <p class="text-dark fw-bold">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏•‡∏ô‡πå ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</p>
            <div class="col-12 text-center mt-2">
                <button class="btn btn-lg linebg text-light" id="login-btn"><img
                        src="https://img.icons8.com/fluency-systems-regular/48/ffffff/line-me.png" />Login</button>
            </div>
        </div>
    </section>
    <section id="input-sec" style="display: none;">
        <div class="container">
            <div class="display-4 mt-4">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ&nbsp;<span id="displayName"></span> <img id="display-img"
                    class="rounded-circle" style="width: 50px;"></div>
            <div class="row justify-content-start mt-3">
                <div class="col-md-4">
                    <label for="altText">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ó‡∏ô FLEX ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ä‡∏ó <span class="text-muted"
                            id="text-count">(0/400)</span></label>
                    <input type="text" class="form-control" id="altText" maxlength="400">
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-md-7 mt-3">
                    <label for="json">JSON</label>
                    <textarea name="json" id="json" rows="15" class="form-control"></textarea>
                    <div class="row g-3 mt-1">
                        <div class="col">
                            <button id="save" class="btn btn-primary w-100"><i
                                    class="bi bi-floppy2-fill"></i>&nbsp;‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                        </div>
                        <!-- <div class="col">
                            <button id="send" class="btn btn-warning hide">‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡∏ô‡∏µ‡πâ</button>
                        </div> -->
                        <!-- <div class="col">
                            <button id="preview" class="btn btn-warning w-100"><i
                                    class="bi bi-eye-fill"></i>&nbsp;‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</button>
                        </div> -->
                        <div class="col">
                            <button id="shared" class="btn btn-success w-100"><i
                                    class="bi bi-share-fill"></i>&nbsp;‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏õ‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡∏≠‡∏∑‡πà‡∏ô</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-5 rounded"
                    style="background-color: #849ebf;background-image: url(./line\ bg.jpg);background-size: contain;overflow: auto;">
                    <div class="reset-this">
                        <div id="flex-show" style="padding-top: 10px;"></div>
                    </div>
                </div>

            </div>
        </div>
    </section>
    <div class="modal fade" id="previewModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="previewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header d-flex justify-content-between">
                    <h5 class="modal-title " id="previewModalLabel">Flex Preview</h5>
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
                <div class="modal-body"
                    style="background-color: #849ebf;background-image: url(./line\ bg.jpg);background-size: contain;">
                    <div class="reset-this container-fluid">
                        <div id="flex1"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-info" id="json-copy">Copy</button>
                    <button type="button" class="btn btn-warning" id="json-update">Update <span class="hide"
                            id="update-id"></span></button>
                </div>
            </div>
        </div>
    </div>
    <section>
        <div class="container mb-5">
            <div class="col-md-4 listtemplate mt-2 hide">
                <div class="btn-group d-flex">
                    <button type="button" class="btn btn-outline-info text-dark fw-bold btn-head col-12"></button>
                    <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <span class="visually-hidden">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                        <!-- <li class="m-1"><a class="btn btn-warning send-flex w-100">‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡∏ô‡∏µ‡πâ</a></li> -->
                        <li class="m-1"><a class="btn btn-success shared-flex w-100">‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏õ‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡∏≠‡∏∑‡πà‡∏ô</a></li>
                        <li class="m-1"><a class="btn btn-secondary show-json w-100">‡∏î‡∏π JSON</a></li>
                        <li class="m-1"><a class="btn btn-warning share-link w-100">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡πÅ‡∏ä‡∏£‡πå</a></li>
                        <li class="m-1"><a class="btn btn-danger delete-list w-100">‡∏•‡∏ö</a></li>
                    </ul>
                </div>
            </div>
            <div id="flexlist" class="row justify-content-start mt-3">

            </div>
        </div>
    </section>
    <!-- <script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>

    <script>

        // VConsole will be exported to `window.VConsole` by default.

        var vConsole = new window.VConsole();

    </script> -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        var Toast
        $(document).ready(() => {
            $.LoadingOverlay("show");
            Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 1500,
                timerProgressBar: true,
            })
            main()
            // flex2html('testflex', JSON.parse(testflex))
        })
        function copy(id = 'json-code') {
            let $temp = $('<input>')
            $('body').append($temp)
            let element = document.getElementById(id)
            element.select()
            element.setSelectionRange(0, 99999)
            navigator.clipboard.writeText(element.value).then(() => {
                $temp.remove()
                Toast.fire({
                    icon: 'success',
                    title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'
                })
            }, () => {
                $temp.remove()
                Toast.fire({
                    icon: 'error',
                    title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'
                })
            })

        }
    </script>
    <script>
        var profile, flexlist
        var scripturl = 'https://script.google.com/macros/s/AKfycbyzG1Rvks3zwXHmHjIga9hlLTyqZg88WRHxXU3TltA3r7yaLCd8MC0dlxzp9zQ_uUAh/exec'
        var parameter = new URLSearchParams(window.location.search)
        var flexid = parameter.get('flexid')
        async function main() {
            await liff.init({ liffId: '1655873446-V51vbbQ7', withLoginOnExternalBrowser: true });
            if (liff.isLoggedIn()) {
                if (flexid) {
                    $.post(scripturl, {
                        id: parameter.get('flexid')
                    }).done(function (result) {
                        console.log("üöÄ ~ $ ~ result:", result)
                        if (result.result) {
                            $.LoadingOverlay("hide");
                            $('#json').val(result.flex)
                            $('#altText').val(result.altText)
                            $('#shared').click()
                        } else {
                            $('section').remove()
                            $('.modal').remove()
                            $.LoadingOverlay("hide");
                            Swal.fire({
                                icon: 'error',
                                title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                                text: '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Flex ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                                allowOutsideClick: false,
                                showConfirmButton: true,
                                confirmButtonText: '‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ',
                            }).then(() => {
                                liff.closeWindow()
                            })
                        }
                    })
                } else {
                    $.LoadingOverlay("hide");
                    $('#login-sec').removeClass('d-flex').hide();
                    $('#input-sec').slideDown(200);
                    let context = await liff.getContext()
                    if (context.type == 'square_chat') {
                        profile = { displayName: 'openchat', userId: context.squareMemberId, isSquare: true }
                    } else profile = await liff.getProfile();
                    $('#displayName').html(profile.displayName);
                    $('#display-img').attr('src', profile.pictureUrl);
                    if (liff.isInClient() || liff.getContext().type === 'square_chat') {
                        $('#send').slideDown(200);
                    }
                    getFlex()
                }
            } else {
                $.LoadingOverlay("hide");
                $('#login-sec div').slideDown(200);
                $('#login-btn').click(function () {
                    liff.login({ redirectUri: window.location.href });
                })
            }
        }
        // getFlex()
    </script>
    <script>
        $('#altText').on('input', function () {
            let text = $(this).val()
            $('#text-count').text(`(${text.length}/400)`)
        })
        $('#json').on('input', function () {
            if($(this).val() == '') {
                $('#flex-show').html('')
                return false
            }
            let json = getJSON(true)
            if (json) {
                $('#flex-show').html('')
                flex2html('flex-show', json)
            } else {
                $('#flex-show').html(`<div style="color: white; font-size: 1rem; text-align: center; padding-top: 20px">
                        Invalid JSON
                    </div>`)
            }
        })
        $('#preview').click(function () {
            let flex = getJSON()
            console.log("üöÄ ~ flex:", flex)
            if (flex) {
                $('#flex1').html('');
                flex2html("flex1", flex);
                $('.modal').modal('show');
            }
        })
        $('#shared').click(function () {
            var flex = getJSON()
            console.log("üöÄ ~ flex", flex);
            if (flex) {
                if (JSON.stringify(flex).indexOf('{{share}}') > -1 && !flexid) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡∏´‡∏≤‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î share ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Flex ‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå',
                    })
                    return false
                }
                sendShare(flex);
            }
        })
        $('#send').click(function () {
            var flex = getJSON()
            if (flex) {
                if (JSON.stringify(flex).indexOf('{{share}}') > -1 && !flexid) {
                    Swal.fire({
                        icon: 'error',
                        title: '‡∏´‡∏≤‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î share ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Flex ‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå',
                    })
                    return false
                }
                sendInChat(flex);
            }
        })
        $('#save').click(function () {
            let flex = getJSON()
            if (flex) {
                Swal.fire({
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠ FLEX',
                    input: 'text',
                    inputAttributes: {
                        autocapitalize: 'off'
                    },
                    showCancelButton: true,
                    confirmButtonText: 'Save',
                    showLoaderOnConfirm: true,
                    preConfirm: (templateName) => {
                        return $.post(scripturl, {
                            q: 'put',
                            isSquare: profile.isSquare,
                            name: templateName,
                            flex: JSON.stringify(flex),
                            uid: profile.userId
                        })
                    },
                    allowOutsideClick: () => !Swal.isLoading()
                }).then((output) => {
                    if (output.value.result == 'duplicate') {
                        return Swal.fire({
                            icon: 'warning',
                            title: 'Oops...',
                            text: '‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    }
                    let item = output.value.data
                    let row = $('.listtemplate').clone()
                    $(row).removeClass('hide listtemplate')
                    $(row).attr('id', item[0])
                    $(row).find('.btn-head').text(item[1])
                    $(row).find('.show-preview').append(`<p style="display: none">${item[2]}</p>`);
                    $(row).find('.delete-list').attr('id', item[0])
                    $(row).find('.show-json').append(`<p style="display: none">${item[2]}</p>`);
                    $(row).find('.share-link').attr('data-clipboard-text', 'https://liff.line.me/' + liff.getContext().liffId + '?flexid=' + item[0])
                    $('#flexlist').append(row)
                    setButtonEventListener()
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                        showConfirmButton: false,
                        timer: 1500
                    })
                })
            }
        })
        function update(id) {
            console.log("üöÄ ~ id", id)
            let flex
            try {
                flex = JSON.parse($('#flex1').find('textarea').val())
            } catch (error) {
                console.log(error)
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Invalid JSON'
                })
                return false
            }
            if (flex) {
                Swal.fire({
                    icon: 'info',
                    title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó JSON...',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                    allowOutsideClick: false,
                })
                Swal.showLoading(Swal.getConfirmButton());
                $.post(scripturl, {
                    q: 'update',
                    isSquare: profile.isSquare,
                    id: id,
                    flex: JSON.stringify(flex),
                }, function (output) {
                    let item = output.data
                    let delbtn = $(`#${id}`)
                    $(delbtn).closest('ul').find('.show-preview p').html(item[2]);
                    $(delbtn).closest('ul').find('.show-json p').html(item[2]);
                    setButtonEventListener()
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                        showConfirmButton: false,
                        timer: 1500
                    })
                })
            }
        }
        function getFlex() {
            $('#flexlist').LoadingOverlay("show");
            let uid = profile.userId;
            console.log(uid)
            $.post(scripturl, {
                q: 'get',
                isSquare: profile.isSquare,
                uid: uid
            }).done(function (result) {

                flexlist = result.data

                console.log(flexlist)

                $('#flexlist').LoadingOverlay("hide");

                if (result.data.length > 0) {

                    $('#flexlist').html('');

                    result.data.forEach(function (item, index) {

                        let row = $('.listtemplate').clone()

                        $(row).removeClass('hide listtemplate')

                        $(row).find('.btn-head').text(item[1])

                        $(row).find('.show-preview').append(`<p style="display: none">${item[2]}</p>`);

                        $(row).find('.delete-list').attr('id', item[0])

                        $(row).find('.show-json').append(`<p style="display: none">${item[2]}</p>`);
                        $(row).find('.share-link').attr('data-clipboard-text', 'https://liff.line.me/' + liff.getContext().liffId + '?flexid=' + item[0])
                        $('#flexlist').append(row)

                    })

                } else {

                    $('#flexlist').css('height', '100%')

                }

                setButtonEventListener()

            })
        }
        function getJSON(noerror = false) {
            let json = $('#json').val()

            try {
                json = JSON.parse($('#json').val())
            } catch (error) {
                if (!noerror) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: 'Invalid JSON'
                    })
                }
                return false
            }
            let flex
            if (json.type != 'flex') {
                let altText = $('#altText').val()
                if (altText == '') altText = 'FLEX MESSAGE'
                flex = {
                    type: 'flex',
                    altText: $('#altText').val(),
                    contents: json
                }
            } else {
                flex = json
            }
            return flex
        }
        async function sendShare(flex) {
            const result = await liff.shareTargetPicker([flex]);
            if (result) {
                Swal.fire({
                    icon: 'success',
                    title: '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                    showConfirmButton: false,
                    timer: 1500
                })
                if (flexid) {
                    liff.closeWindow()
                }
            } else {
                const [majorVer, minorVer, patchVer] = (
                    liff.getLineVersion() || ''
                ).split('.');
                if (minorVer === undefined) {
                    console.log('ShareTargetPicker was canceled in external browser');
                    return;
                }
                if (
                    parseInt(majorVer) >= 10 &&
                    parseInt(minorVer) >= 10 &&
                    parseInt(patchVer) > 0
                ) {
                    console.log('ShareTargetPicker was canceled in LINE app');
                }
            }
        }
        async function sendInChat(flex) {
            liff.sendMessages([flex])
                .then(() => {
                    Swal.fire({
                        icon: 'success',
                        title: '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(() => {
                        liff.closeWindow();
                    })
                })
                .catch((err) => {
                    console.log("error", err);
                    Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ'
                    })
                });
        }
        function setButtonEventListener() {
            $('.btn-head').click(function () {
                let json = $(this).parent().find('ul').find('.show-json p').text()
                $('#json').val(JSON.stringify(JSON.parse(json), undefined, 4))
                setTimeout(() => {
                    $('#json').trigger('input')
                }, 200);
                $('#altText').val($(this).text())
                $('#flex-show').html('')
                // flex2html('flex-show', JSON.parse(json))
            })
            $('.show-preview').click(function () {
                $('#flex1').html('');
                let json = JSON.parse($(this).find('p').text())
                $('#json').val(JSON.stringify(json, undefined, 4))
                setTimeout(() => {
                    $('#json').trigger('input')
                    setTimeout(() => {
                        $('#json').val('')
                    }, 200);
                }, 200);
                $('#json-update').hide()
                $('#json-copy').hide()
                $('.modal').modal('show');
            })
            $('.show-json').click(function () {
                $('#json-update').show()
                $('#json-copy').show()
                $('#flex1').html(`<div><textarea id="json-code" class="p-2 form-control bg-white" rows="20">${JSON.stringify(JSON.parse($(this).find('p').text()), undefined, 4)
                    }</textarea></div>`);
                $('#json-copy').click(function () {
                    copy()
                })
                let showjsonbtn = $(this)
                $('#json-update').click(function () {

                    update(showjsonbtn.closest('ul').find('.delete-list').attr('id'))
                })
                $('.modal').modal('show');
            })
            $('.delete-list').click(function () {
                let button = $(this)
                Swal.fire({
                    title: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?',
                    text: "‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: '‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ',
                    cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
                }).then((result) => {
                    if (result.value) {
                        Swal.fire({
                            title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£',
                            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                            allowOutsideClick: false,
                        })
                        Swal.showLoading(Swal.getConfirmButton())
                        $.post(scripturl, {
                            q: 'delete',
                            id: $(this).attr('id')
                        }, function (result) {
                            if (result.result == 'success') {
                                Swal.fire({
                                    icon: 'success',
                                    title: '‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                                    showConfirmButton: false,
                                    timer: 1500
                                })
                                $(button).closest('.col-md-4').remove()
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: '‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                                    showConfirmButton: false,
                                    timer: 1500
                                })
                            }
                        })
                    }
                })
            })

            $('.share-link').click(function () {
                let $temp = $('<input>')
                $('body').append($temp)
                navigator.clipboard.writeText($(this).attr('data-clipboard-text')).then(() => {
                    $temp.remove()
                    Toast.fire({
                        icon: 'success',
                        title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'
                    })
                }, () => {
                    $temp.remove()
                    Toast.fire({
                        icon: 'error',
                        title: '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'
                    })
                })
            })

            if (liff.isInClient() || liff.getContext().type == 'square_chat') {
                $('.send-flex').click(function () {
                    let button = $(this)
                    let id = $(this).closest('.col-md-4').find('.delete-list').attr('id')
                    let flextext = $(this).closest('.col-md-4').find('.show-json').find('p').text()

                    let flex = JSON.parse(flextext)
                    sendInChat(flex)
                })
            } else {
                $('.send-flex').hide()
            }
            $('.shared-flex').click(function () {
                let button = $(this)
                let id = $(this).closest('.col-md-4').find('.delete-list').attr('id')
                let flextext = $(this).closest('.col-md-4').find('.show-json').find('p').text()

                let flex = JSON.parse(flextext)
                sendShare(flex)
            })
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>